<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Route Builder + Map</title>

    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/popout.css?v=99" />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
<link rel="stylesheet" href="assets/css/pp-nav.css" />
    <style>
      .rm-layout {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 12px;
        margin-top: 12px;
        align-items: start;
      }
      @media (max-width: 980px) {
        .rm-layout {
          grid-template-columns: 1fr;
        }
      }

      #rmMap {
        height: 72vh;
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.03);
      }

      .rm-sticky {
        position: sticky;
        top: 74px;
      }

      .rm-results {
        display: grid;
        gap: 10px;
      }

      .rm-minihead {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        align-items: flex-end;
      }
    </style>
  </head>

  <body>
    <div data-include="includes/header.html"></div>

    <main class="pp-container">
      <section class="pp-card pp-pad">
        <div class="pp-mini">
          Single page: Search → Itinerary → Map (auto sync)
        </div>
        <h1 class="pp-h1">Route Builder</h1>
        <div class="pp-muted">
          Same storage key: <b>pp_tour_maker_v1</b>. Any change updates the map
          immediately.
        </div>
      </section>

      <div class="rm-layout">
        <!-- LEFT: Search + Itinerary -->
        <div class="rm-sticky">
          <!-- Search -->
          <section class="pp-card pp-pad">
            <div class="pp-h2">Search & Add</div>
            <div class="pp-mini" id="rsStatus" style="margin-top: 6px">
              Loading data…
            </div>

            <div class="pp-actions" style="margin-top: 10px">
              <select id="rsSource" class="pp-input" title="Search source">
                <option value="locations">Only locations.json</option>
                <option value="osm">Only OpenStreetMap</option>
                <option value="both">Both (locations first)</option>
              </select>

              <input
                id="rsQuery"
                class="pp-input"
                style="flex: 1"
                placeholder="Type 3+ characters…"
                autocomplete="off"
              />
              <button class="pp-btn" id="rsSearchBtn" type="button">
                Search
              </button>
              <button
                class="pp-btn pp-btn--ghost"
                id="rsClearBtn"
                type="button"
              >
                Clear
              </button>
            </div>

            <div
              style="margin-top: 12px"
              class="rm-results"
              id="rsResults"
            ></div>
          </section>

          <!-- Itinerary -->
          <section class="pp-card pp-pad" style="margin-top: 12px">
            <div  class="rm-minihead">
              <div>
                <div class="pp-h2">Itinerary</div>
                <div class="pp-mini">Auto-updates map</div>
              </div>
              <div class="pp-actions">
                <button
                  class="pp-btn pp-btn--ghost"
                  id="rsDownloadBtn"
                  type="button"
                >
                  Download
                </button>
                <button class="pp-btn" id="rsShareBtn" type="button">
                  WhatsApp
                </button>
                <button
                  class="pp-btn pp-btn--ghost"
                  id="rsClearItBtn"
                  type="button"
                >
                  Clear
                </button>
              </div>
            </div>

            <div
              id="rsItinerary"
              style="margin-top: 12px; display: grid; gap: 10px"
            ></div>
          </section>
        </div>

        <!-- RIGHT: Map -->
        <section class="pp-card pp-pad">
          <div class="rm-minihead">
            <div>
              <div class="pp-h2">Map</div>
              <div class="pp-mini" id="rmStatus">Ready.</div>
            </div>
            <div class="pp-actions">
              <a class="pp-btn pp-btn--ghost" href="routes.html"
                >Open old Routes page</a
              >
            </div>
          </div>

          <div style="margin-top: 12px" id="rmMap"></div>
        </section>
      </div>
    </main>

    <div data-include="includes/footer.html"></div>

    <!-- Includes -->
    <script src="assets/js/includes.js"></script>
    <script src="assets/js/pp-nav.js"></script>

    <!-- Leaflet -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- Data + render + popout -->
     
     <script src="assets/js/site-config.js"></script>

    <script src="assets/js/data-store.js"></script>
    <script src="assets/js/render.js"></script>
    <script src="assets/js/popout.js"></script>

    <!-- NEW: combined editor + map -->
    <script src="assets/js/route-editor.js"></script>
  </body>
</html>
