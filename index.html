<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Home</title>

    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/popout.css" />
    <link rel="stylesheet" href="assets/css/pp-nav.css" />
    <style>
      /* ---- home-only polish (light saffron) ---- */
      .hp-hero {
        margin-top: 12px;
        border: 1px solid rgba(31, 41, 55, 0.12);
        border-radius: 22px;
        overflow: hidden;
        background:
          radial-gradient(
            1200px 500px at 10% 0%,
            rgba(245, 158, 11, 0.28),
            transparent 60%
          ),
          radial-gradient(
            900px 420px at 90% 20%,
            rgba(217, 119, 6, 0.2),
            transparent 58%
          ),
          linear-gradient(
            145deg,
            rgba(255, 247, 230, 0.95),
            rgba(255, 241, 214, 0.82)
          );
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.07);
        position: relative;
      }
      .hp-hero .inner {
        padding: 18px 16px;
      }
      .hp-hero h1 {
        margin: 8px 0 0;
        font-size: 30px;
        line-height: 1.08;
        font-weight: 1000;
      }
      .hp-hero p {
        margin: 10px 0 0;
        max-width: 62ch;
      }
      .hp-badges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      .hp-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(31, 41, 55, 0.12);
        background: rgba(255, 255, 255, 0.72);
        font-weight: 900;
        font-size: 12px;
      }
      .hp-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 14px;
      }
      .hp-grid {
        margin-top: 12px;
        display: grid;
        gap: 12px;
        grid-template-columns: 1.2fr 0.8fr;
        align-items: start;
      }
      @media (max-width: 980px) {
        .hp-grid {
          grid-template-columns: 1fr;
        }
      }
      .hp-panel {
        border: 1px solid rgba(31, 41, 55, 0.12);
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.72);
        padding: 14px;
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.06);
      }
      .hp-kpis {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .hp-kpi {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        padding: 8px 10px;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.03);
        border: 1px solid rgba(31, 41, 55, 0.1);
        font-weight: 1000;
      }
      .hp-searchRow {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .hp-searchRow > * {
        flex: 1;
        min-width: 160px;
      }
      .hp-results {
        margin-top: 12px;
        display: grid;
        gap: 10px;
      }
      .hp-item {
        border: 1px solid rgba(31, 41, 55, 0.12);
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.86);
        overflow: hidden;
      }
      .hp-item .top {
        display: flex;
        gap: 12px;
        align-items: center;
        padding: 12px;
      }
      .hp-item .thumb {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.03);
        flex: 0 0 auto;
        display: grid;
        place-items: center;
        overflow: hidden;
      }
      .hp-item .thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .hp-item .meta {
        flex: 1;
      }
      .hp-item .ttl {
        font-weight: 1000;
      }
      .hp-item .sub {
        font-size: 12px;
        opacity: 0.75;
        margin-top: 4px;
      }
      .hp-item .chips {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 8px;
      }
      .hp-item .chips .pp-pill {
        font-size: 12px;
      }
      .hp-sectTitle {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        align-items: end;
      }
      .hp-sectTitle .pp-mini {
        margin-top: 2px;
      }
      .hp-miniLinks {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .hp-muted {
        opacity: 0.75;
      }
      .hp-divider {
        height: 1px;
        background: rgba(31, 41, 55, 0.1);
        margin: 12px 0;
      }
      .hp-footnote {
        font-size: 12px;
        opacity: 0.78;
        margin-top: 10px;
      }
    </style>

    <link rel="stylesheet" href="assets/css/pp-carousel.css" />
    <link rel="stylesheet" href="assets/css/pp-nav.css" />
  </head>

  <body>
    <div data-include="includes/header.html"></div>

    <main class="pp-container">
      <div class="pp-carousel" data-ppc autoplay="1" interval="4000">
        <div
          class="ppc-slide"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        >
          <img src="assets/images/champak/ch0.jpeg" alt="" />
        </div>
        <div
          class="ppc-slide"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        >
          <img src="assets/images/varanasi/0.jpg" alt="" />
        </div>
        <div
          class="ppc-slide"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        >
          <img src="assets/images/varanasi/1.jpg" alt="" />
        </div>
        <div
          class="ppc-slide"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        >
          <img src="assets/images/varanasi/2.jpg" alt="" />
        </div>
        <div
          class="ppc-slide"
          data-yt="UY1r_BCEsj4"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        ></div>
        <div
          class="ppc-slide"
          data-kicker="Kashi ‚Ä¢ Varanasi"
          data-title="Build Your Route in Minutes"
          data-sub="Search places, add itinerary, open Route Map, share on WhatsApp."
          data-chip="üó∫ Route + Itinerary"
        >
          <img src="assets/images/champak/ch1.jpeg" alt="" />
        </div>
      </div>

      <!-- HERO -->
      <section class="hp-hero">
        <div class="inner">
          <div class="pp-split">
            <div>
              <div class="pp-mini" id="hpMini"></div>
              <h1 id="hpTitle">Spiritual Tours ‚Ä¢ Rituals ‚Ä¢ Kathas</h1>
              <p class="pp-muted" id="hpSubtitle">
                Plan trips to Kashi, Ayodhya, Prayagraj ‚Äî book rituals, kathas &
                arrangements. Build itinerary, view route on map, and share on
                WhatsApp.
              </p>

              <div class="hp-badges">
                <span class="hp-badge">üìç Locations database</span>
                <span class="hp-badge">üó∫ Route Map</span>
                <span class="hp-badge">üìÖ Festivals Calendar</span>
                <span class="hp-badge">üí¨ WhatsApp enquiry</span>
              </div>

              <div class="hp-actions">
                <a class="pp-btn" href="routes.html" id="hpCta1"
                  >Start Route Builder</a
                >
                <a class="pp-btn pp-btn--ghost" href="route.html" id="hpCta2"
                  >Open Route Map</a
                >
                <a class="pp-btn pp-btn--ghost" href="calendar.html" id="hpCta3"
                  >Open Calendar</a
                >
                <button
                  class="pp-btn pp-btn--ghost"
                  id="ppLangBtn"
                  type="button"
                >
                  HI
                </button>
              </div>
            </div>

            <div class="hp-panel" style="max-width: 420px">
              <div class="hp-sectTitle">
                <div>
                  <div class="pp-h2" id="hpQuickTitle">Quick Actions</div>
                  <div class="pp-mini hp-muted" id="hpQuickSub">
                    Everything important in one tap
                  </div>
                </div>
                <div class="hp-miniLinks">
                  <a class="pp-btn pp-btn--ghost" href="admin-locations.html"
                    >Admin</a
                  >
                </div>
              </div>

              <div class="hp-divider"></div>

              <div class="pp-actions" style="gap: 10px; flex-wrap: wrap">
                <a
                  class="pp-btn pp-btn--ghost"
                  href="tours.html"
                  id="hpLinkTours"
                  >Tours</a
                >
                <a
                  class="pp-btn pp-btn--ghost"
                  href="tour-maker.html"
                  id="hpLinkMaker"
                  >Tour Maker</a
                >
                <a
                  class="pp-btn pp-btn--ghost"
                  href="kathas.html"
                  id="hpLinkKathas"
                  >Kathas</a
                >
                <a
                  class="pp-btn pp-btn--ghost"
                  href="rituals.html"
                  id="hpLinkRituals"
                  >Rituals</a
                >
                <a
                  class="pp-btn pp-btn--ghost"
                  href="occasions.html"
                  id="hpLinkOcc"
                  >Occasions</a
                >
              </div>

              <div class="hp-kpis" id="hpKpis">
                <span class="hp-kpi"
                  >üèôÔ∏è Cities: <span id="kpiCities">‚Ä¶</span></span
                >
                <span class="hp-kpi"
                  >üìå Places: <span id="kpiPlaces">‚Ä¶</span></span
                >
                <span class="hp-kpi"
                  >üéâ Occasions: <span id="kpiOcc">‚Ä¶</span></span
                >
              </div>

              <div class="hp-footnote" id="hpFoot">
                Tip: Use the search below to find a place or festival and jump
                directly to building the itinerary.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SEARCH + HIGHLIGHTS -->
      <section class="hp-grid">
        <!-- LEFT: Smart Search -->
        <section class="hp-panel">
          <div class="hp-sectTitle">
            <div>
              <div class="pp-h2" id="ssTitle">Smart Search</div>
              <div class="pp-mini hp-muted" id="ssSub">
                Search across Locations + Occasions (3+ characters)
              </div>
            </div>
            <div class="hp-miniLinks">
              <a class="pp-btn pp-btn--ghost" href="routes.html" id="ssGoRoutes"
                >Go to Routes</a
              >
            </div>
          </div>

          <div class="hp-searchRow">
            <input
              class="pp-input"
              id="ssQuery"
              placeholder="Type: Kashi / Sangam / Shivratri ‚Ä¶"
              autocomplete="off"
            />
            <select class="pp-input" id="ssMode">
              <option value="both">Locations + Occasions</option>
              <option value="locations">Locations only</option>
              <option value="occasions">Occasions only</option>
            </select>
            <button class="pp-btn" id="ssBtn" type="button">Search</button>
            <button class="pp-btn pp-btn--ghost" id="ssClear" type="button">
              Clear
            </button>
          </div>

          <div class="pp-mini hp-muted" id="ssStatus" style="margin-top: 10px">
            Loading master data‚Ä¶
          </div>
          <div class="hp-results" id="ssResults"></div>
        </section>

        <!-- RIGHT: Today / This month -->
        <section class="hp-panel">
          <div class="hp-sectTitle">
            <div>
              <div class="pp-h2" id="hiTitle">Highlights</div>
              <div class="pp-mini hp-muted" id="hiSub">
                Today + this month from occasions.json
              </div>
            </div>
            <div class="hp-miniLinks">
              <a class="pp-btn pp-btn--ghost" href="calendar.html">Calendar</a>
            </div>
          </div>

          <div class="hp-divider"></div>

          <div class="pp-mini" id="hiTodayLbl">Today</div>
          <div id="hiToday" class="hp-results"></div>

          <div class="hp-divider"></div>

          <div class="pp-mini" id="hiMonthLbl">This Month</div>
          <div id="hiMonth" class="hp-results"></div>

          <div class="hp-footnote hp-muted">
            Festivals based on your <b>data/master/occasions.json</b>.
          </div>
        </section>
      </section>

      <!-- CITY SPOTLIGHT -->
      <section class="pp-card pp-pad" style="margin-top: 12px">
        <div class="hp-sectTitle">
          <div>
            <div class="pp-h2" id="csTitle">City Spotlight</div>
            <div class="pp-mini hp-muted" id="csSub">
              Top places from locations.json
            </div>
          </div>
          <div class="hp-miniLinks">
            <a class="pp-btn pp-btn--ghost" href="tours.html">Tours</a>
            <a class="pp-btn pp-btn--ghost" href="routes.html">Routes</a>
          </div>
        </div>

        <div class="pp-actions" style="margin-top: 12px">
          <select class="pp-input" id="csCity"></select>
          <button class="pp-btn pp-btn--ghost" id="csAddAll" type="button">
            Add top 5 to itinerary
          </button>
          <a class="pp-btn" href="routes.html">Open Itinerary</a>
        </div>

        <div class="pp-grid" id="csGrid" style="margin-top: 12px"></div>
      </section>

      <div class="pp-mini hp-muted" style="margin: 14px 0 0">
        Powered by master data: <b>data/master/locations.json</b>,
        <b>data/master/occasions.json</b>.
      </div>
    </main>

    <div data-include="includes/footer.html"></div>

    <!-- Core -->
    <script src="assets/js/includes.js"></script>
    <script src="assets/js/pp-nav.js"></script>

    <script src="assets/js/site-config.js"></script>
    <script src="assets/js/lang.js"></script>

    <!-- Optional (if you use popout elsewhere) -->
    <script src="assets/js/render.js"></script>
    <script src="assets/js/popout.js"></script>

    <!-- Find on page -->
    <script src="https://programmer-s-picnic.github.io/json-images/find-on-page.js"></script>
    <script src="assets/js/pp-carousel.js"></script>

    <script>
      (function () {
        const LOC_PATH = "data/master/locations.json";
        const OCC_PATH = "data/master/occasions.json";
        const STORE_KEY = "pp_tour_maker_v1"; // keep consistent with your routes system

        const $ = (id) => document.getElementById(id);
        const pad2 = (n) => String(n).padStart(2, "0");
        const iso = (d) =>
          `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;

        function t(obj) {
          if (!window.PP_LANG)
            return typeof obj === "string" ? obj : obj?.en || obj?.hi || "";
          return PP_LANG.t(obj);
        }

        function setLangTexts() {
          const hi = PP_LANG.getLang() === "hi";
          $("ppLangBtn").textContent = hi ? "EN" : "HI";

          $("hpMini").textContent = hi
            ? "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‚Ä¢ ‡§Ö‡§®‡•Å‡§∑‡•ç‡§†‡§æ‡§® ‚Ä¢ ‡§ï‡§•‡§æ ‚Ä¢ ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™"
            : "Tours ‚Ä¢ Rituals ‚Ä¢ Kathas ‚Ä¢ WhatsApp";
          $("hpTitle").textContent = hi
            ? "‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ‡§è‡§Å ‚Ä¢ ‡§Ö‡§®‡•Å‡§∑‡•ç‡§†‡§æ‡§® ‚Ä¢ ‡§ï‡§•‡§æ‡§è‡§Å"
            : "Spiritual Tours ‚Ä¢ Rituals ‚Ä¢ Kathas";
          $("hpSubtitle").textContent = hi
            ? "‡§ï‡§æ‡§∂‡•Ä, ‡§Ö‡§Ø‡•ã‡§ß‡•ç‡§Ø‡§æ, ‡§™‡•ç‡§∞‡§Ø‡§æ‡§ó‡§∞‡§æ‡§ú ‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§™‡•ç‡§≤‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç ‚Äî ‡§Ö‡§®‡•Å‡§∑‡•ç‡§†‡§æ‡§®/‡§ï‡§•‡§æ ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç, ‡§Æ‡•à‡§™ ‡§™‡§∞ ‡§∞‡•Ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç‡•§"
            : "Plan trips to Kashi, Ayodhya, Prayagraj ‚Äî book rituals, kathas & arrangements. Build itinerary, view route on map, and share on WhatsApp.";

          $("hpCta1").textContent = hi
            ? "‡§∞‡•Ç‡§ü ‡§¨‡§ø‡§≤‡•ç‡§°‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç"
            : "Start Route Builder";
          $("hpCta2").textContent = hi ? "‡§∞‡•Ç‡§ü ‡§Æ‡•à‡§™ ‡§ñ‡•ã‡§≤‡•á‡§Ç" : "Open Route Map";
          $("hpCta3").textContent = hi ? "‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§ñ‡•ã‡§≤‡•á‡§Ç" : "Open Calendar";

          $("hpQuickTitle").textContent = hi ? "‡§ï‡•ç‡§µ‡§ø‡§ï ‡§è‡§ï‡•ç‡§∂‡§®" : "Quick Actions";
          $("hpQuickSub").textContent = hi
            ? "‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§è‡§ï ‡§ü‡•à‡§™ ‡§Æ‡•á‡§Ç"
            : "Everything important in one tap";
          $("hpFoot").textContent = hi
            ? "‡§ü‡§ø‡§™: ‡§®‡•Ä‡§ö‡•á ‡§∏‡§∞‡•ç‡§ö ‡§∏‡•á ‡§ú‡§ó‡§π/‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§¨‡§®‡§æ‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç‡•§"
            : "Tip: Use the search below to find a place or festival and jump directly to building the itinerary.";

          $("ssTitle").textContent = hi ? "‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∏‡§∞‡•ç‡§ö" : "Smart Search";
          $("ssSub").textContent = hi
            ? "‡§≤‡•ã‡§ï‡•á‡§∂‡§® + ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ (3+ ‡§Ö‡§ï‡•ç‡§∑‡§∞)"
            : "Search across Locations + Occasions (3+ characters)";
          $("ssGoRoutes").textContent = hi ? "Routes ‡§ñ‡•ã‡§≤‡•á‡§Ç" : "Go to Routes";
          $("ssQuery").placeholder = hi
            ? "‡§≤‡§ø‡§ñ‡•á‡§Ç: ‡§ï‡§æ‡§∂‡•Ä / ‡§∏‡§Ç‡§ó‡§Æ / ‡§∂‡§ø‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø ‚Ä¶"
            : "Type: Kashi / Sangam / Shivratri ‚Ä¶";
          $("ssBtn").textContent = hi ? "‡§ñ‡•ã‡§ú‡•á‡§Ç" : "Search";
          $("ssClear").textContent = hi ? "‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç" : "Clear";
          $("ssMode").options[0].text = hi
            ? "‡§≤‡•ã‡§ï‡•á‡§∂‡§® + ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞"
            : "Locations + Occasions";
          $("ssMode").options[1].text = hi ? "‡§ï‡•á‡§µ‡§≤ ‡§≤‡•ã‡§ï‡•á‡§∂‡§®" : "Locations only";
          $("ssMode").options[2].text = hi ? "‡§ï‡•á‡§µ‡§≤ ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞" : "Occasions only";

          $("hiTitle").textContent = hi ? "‡§π‡§æ‡§á‡§≤‡§æ‡§á‡§ü‡•ç‡§∏" : "Highlights";
          $("hiSub").textContent = hi ? "‡§Ü‡§ú + ‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á" : "Today + this month";
          $("hiTodayLbl").textContent = hi ? "‡§Ü‡§ú" : "Today";
          $("hiMonthLbl").textContent = hi ? "‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á" : "This Month";

          $("csTitle").textContent = hi ? "‡§∂‡§π‡§∞ ‡§∏‡•ç‡§™‡•â‡§ü‡§≤‡§æ‡§á‡§ü" : "City Spotlight";
          $("csSub").textContent = hi
            ? "locations.json ‡§∏‡•á ‡§ü‡•â‡§™ ‡§∏‡•ç‡§•‡§æ‡§®"
            : "Top places from locations.json";
          $("csAddAll").textContent = hi
            ? "‡§ü‡•â‡§™ 5 ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç"
            : "Add top 5 to itinerary";
        }

        function norm(s) {
          return (s || "").toString().trim().toLowerCase();
        }

        function pill(tag) {
          return `<span class="pp-pill">${tag}</span>`;
        }

        function card({ type, title, sub, img, tags, href, onAdd, waText }) {
          const tagHtml = (tags || []).slice(0, 6).map(pill).join("");
          const btns = `
          <div class="pp-actions" style="padding:0 12px 12px">
            ${href ? `<a class="pp-btn pp-btn--ghost" href="${href}">${PP_LANG.getLang() === "hi" ? "‡§ñ‡•ã‡§≤‡•á‡§Ç" : "Open"}</a>` : ""}
            ${onAdd ? `<button class="pp-btn" type="button" data-add="1">${PP_LANG.getLang() === "hi" ? "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç" : "Add to Itinerary"}</button>` : ""}
            ${
              waText
                ? `<a class="pp-btn pp-btn--ghost" target="_blank" rel="noopener"
              href="https://wa.me/${(window.PP_CONFIG?.contact?.primary?.whatsapp || "").replace(/\D/g, "")}?text=${encodeURIComponent(waText)}">
              WhatsApp</a>`
                : ""
            }
          </div>
        `;
          const html = document.createElement("div");
          html.className = "hp-item";
          html.innerHTML = `
          <div class="top">
            <div class="thumb">${img ? `<img src="${img}" alt="">` : "üìå"}</div>
            <div class="meta">
              <div class="ttl">${title}</div>
              <div class="sub">${sub || type}</div>
              <div class="chips">${tagHtml}</div>
            </div>
          </div>
          ${btns}
        `;
          if (onAdd) {
            html.querySelector('[data-add="1"]').onclick = onAdd;
          }
          return html;
        }

        function loadIt() {
          try {
            return JSON.parse(localStorage.getItem(STORE_KEY) || "{}");
          } catch {
            return {};
          }
        }
        function saveIt(obj) {
          localStorage.setItem(STORE_KEY, JSON.stringify(obj));
        }
        function addToItinerary(place) {
          const db = loadIt();
          db.itinerary = Array.isArray(db.itinerary) ? db.itinerary : [];
          const exists = db.itinerary.some((x) => x && x.id === place.id);
          if (!exists) {
            db.itinerary.push(place);
            saveIt(db);
          }
        }

        let LOC = null,
          OCC = null;

        function kpis() {
          const cities = LOC?.cities?.length || 0;
          let places = 0;
          (LOC?.cities || []).forEach((c) => (places += c.places?.length || 0));
          $("kpiCities").textContent = cities;
          $("kpiPlaces").textContent = places;
          $("kpiOcc").textContent = OCC?.occasions?.length || 0;
        }

        function renderHighlights() {
          const todayISO = iso(new Date());
          const month = new Date().getMonth() + 1;
          const year = new Date().getFullYear();

          const todayList = (OCC?.occasions || []).filter((o) =>
            (o.dates || []).includes(todayISO),
          );
          const monthList = (OCC?.occasions || [])
            .filter((o) => {
              const ds = o.dates || [];
              return ds.some(
                (x) => x && x.startsWith(`${year}-${pad2(month)}-`),
              );
            })
            .slice(0, 6);

          const hi = PP_LANG.getLang() === "hi";

          const into = (hostId, list, emptyMsg) => {
            const host = $(hostId);
            host.innerHTML = "";
            if (!list.length) {
              host.innerHTML = `<div class="pp-muted">${emptyMsg}</div>`;
              return;
            }
            list.forEach((o) => {
              const title = t(o.title) || o.id;
              const sub = t(o.summary) || t(o.description) || "";
              const img =
                o.images && o.images[0]
                  ? o.images[0]
                  : "assets/images/placeholder/place.svg";
              const tags = o.tags || [];
              host.appendChild(
                card({
                  type: "Occasion",
                  title,
                  sub,
                  img,
                  tags,
                  href: "calendar.html",
                  waText:
                    (t(o.whatsappText) ||
                      (hi ? "‡§Æ‡•Å‡§ù‡•á ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è: " : "I want details for: ")) +
                    title,
                }),
              );
            });
          };

          into(
            "hiToday",
            todayList,
            hi
              ? "‡§Ü‡§ú ‡§ï‡•ã‡§à ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§"
              : "No occasions listed for today.",
          );
          into(
            "hiMonth",
            monthList,
            hi
              ? "‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≠‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§"
              : "No occasions listed for this month.",
          );
        }

        function citySpotlight() {
          const sel = $("csCity");
          sel.innerHTML = "";
          (LOC?.cities || []).forEach((c) => {
            const opt = document.createElement("option");
            opt.value = c.id;
            opt.textContent = t(c.name) || c.id;
            sel.appendChild(opt);
          });

          function render() {
            const id = sel.value;
            const city =
              (LOC?.cities || []).find((c) => c.id === id) ||
              (LOC?.cities || [])[0];
            if (!city) return;

            const grid = $("csGrid");
            grid.innerHTML = "";

            (city.places || []).slice(0, 6).forEach((p) => {
              const title = t(p.name) || p.id;
              const sub = t(p.description) || "";
              const img =
                p.images && p.images[0]
                  ? p.images[0]
                  : "assets/images/placeholder/place.svg";
              const tags = p.tags || [];
              const placeObj = {
                id: `${city.id}:${p.id}`,
                name: title,
                lat: p.lat,
                lng: p.lng,
                meta: { cityId: city.id, placeId: p.id },
              };

              grid.appendChild(
                card({
                  type: "Place",
                  title,
                  sub,
                  img,
                  tags,
                  href: "routes.html",
                  onAdd: () => {
                    addToItinerary(placeObj);
                    alert(
                      PP_LANG.getLang() === "hi"
                        ? "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ"
                        : "Added to itinerary",
                    );
                  },
                }),
              );
            });
          }

          sel.onchange = render;
          render();

          $("csAddAll").onclick = () => {
            const city = (LOC?.cities || []).find((c) => c.id === sel.value);
            if (!city) return;
            (city.places || []).slice(0, 5).forEach((p) => {
              addToItinerary({
                id: `${city.id}:${p.id}`,
                name: t(p.name) || p.id,
                lat: p.lat,
                lng: p.lng,
                meta: { cityId: city.id, placeId: p.id },
              });
            });
            alert(
              PP_LANG.getLang() === "hi"
                ? "‡§ü‡•â‡§™ 5 ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§è ‡§ó‡§è"
                : "Top 5 added to itinerary",
            );
          };
        }

        function smartSearch() {
          const qEl = $("ssQuery");
          const modeEl = $("ssMode");
          const resEl = $("ssResults");
          const stEl = $("ssStatus");

          function matchText(obj) {
            // match both langs regardless of current lang
            if (!obj) return "";
            if (typeof obj === "string") return obj;
            return `${obj.en || ""} ${obj.hi || ""}`.trim();
          }

          function doSearch() {
            const q = norm(qEl.value);
            const mode = modeEl.value;
            resEl.innerHTML = "";
            if (q.length < 3) {
              stEl.textContent =
                PP_LANG.getLang() === "hi"
                  ? "‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 3 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§≤‡§ø‡§ñ‡•á‡§Ç‚Ä¶"
                  : "Type at least 3 characters‚Ä¶";
              return;
            }
            stEl.textContent =
              PP_LANG.getLang() === "hi" ? "‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‚Ä¶" : "Searching‚Ä¶";

            const hits = [];

            if (mode === "both" || mode === "locations") {
              (LOC?.cities || []).forEach((c) => {
                (c.places || []).forEach((p) => {
                  const hay = norm(
                    `${c.id} ${matchText(p.name)} ${matchText(p.description)} ${(p.tags || []).join(" ")}`,
                  );
                  if (hay.includes(q)) {
                    hits.push({ kind: "place", city: c, place: p });
                  }
                });
              });
            }

            if (mode === "both" || mode === "occasions") {
              (OCC?.occasions || []).forEach((o) => {
                const hay = norm(
                  `${o.id} ${matchText(o.title)} ${matchText(o.summary)} ${matchText(o.description)} ${(o.tags || []).join(" ")} ${(o.dates || []).join(" ")}`,
                );
                if (hay.includes(q)) {
                  hits.push({ kind: "occasion", occ: o });
                }
              });
            }

            if (!hits.length) {
              stEl.textContent =
                PP_LANG.getLang() === "hi"
                  ? "‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ"
                  : "No results";
              return;
            }

            stEl.textContent =
              PP_LANG.getLang() === "hi"
                ? `${hits.length} ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ`
                : `${hits.length} result(s)`;

            hits.slice(0, 12).forEach((h) => {
              if (h.kind === "place") {
                const c = h.city,
                  p = h.place;
                const title = t(p.name) || p.id;
                const sub = `${t(c.name) || c.id} ‚Ä¢ ${t(p.description) || ""}`;
                const img =
                  p.images && p.images[0]
                    ? p.images[0]
                    : "assets/images/placeholder/place.svg";
                const tags = p.tags || [];
                const placeObj = {
                  id: `${c.id}:${p.id}`,
                  name: title,
                  lat: p.lat,
                  lng: p.lng,
                  meta: { cityId: c.id, placeId: p.id },
                };
                resEl.appendChild(
                  card({
                    type: "Place",
                    title,
                    sub,
                    img,
                    tags,
                    href: "routes.html",
                    onAdd: () => {
                      addToItinerary(placeObj);
                      alert(
                        PP_LANG.getLang() === "hi"
                          ? "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ"
                          : "Added to itinerary",
                      );
                    },
                  }),
                );
              } else {
                const o = h.occ;
                const title = t(o.title) || o.id;
                const sub =
                  ((o.dates || [])[0] ? `${(o.dates || [])[0]} ‚Ä¢ ` : "") +
                  (t(o.summary) || "");
                const img =
                  o.images && o.images[0]
                    ? o.images[0]
                    : "assets/images/placeholder/place.svg";
                const tags = o.tags || [];
                resEl.appendChild(
                  card({
                    type: "Occasion",
                    title,
                    sub,
                    img,
                    tags,
                    href: "calendar.html",
                    waText:
                      (t(o.whatsappText) ||
                        (PP_LANG.getLang() === "hi"
                          ? "‡§Æ‡•Å‡§ù‡•á ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è: "
                          : "I want details for: ")) + title,
                  }),
                );
              }
            });
          }

          $("ssBtn").onclick = doSearch;
          $("ssClear").onclick = () => {
            qEl.value = "";
            resEl.innerHTML = "";
            $("ssStatus").textContent =
              PP_LANG.getLang() === "hi" ? "‡§§‡•à‡§Ø‡§æ‡§∞" : "Ready";
          };

          qEl.addEventListener("input", () => {
            if ((qEl.value || "").trim().length >= 3) doSearch();
          });

          window.addEventListener("pp:langchange", () => {
            // re-render texts and rerun search if query exists
            setLangTexts();
            renderHighlights();
            citySpotlight();
            if ((qEl.value || "").trim().length >= 3) doSearch();
          });
        }

        async function init() {
          // Toggle
          const btn = $("ppLangBtn");
          btn.onclick = () =>
            PP_LANG.setLang(PP_LANG.getLang() === "hi" ? "en" : "hi");

          setLangTexts();

          try {
            const [locRes, occRes] = await Promise.all([
              fetch(LOC_PATH, { cache: "no-store" }),
              fetch(OCC_PATH, { cache: "no-store" }),
            ]);

            LOC = locRes.ok ? await locRes.json() : { cities: [] };
            OCC = occRes.ok ? await occRes.json() : { occasions: [] };

            $("ssStatus").textContent =
              PP_LANG.getLang() === "hi" ? "‡§§‡•à‡§Ø‡§æ‡§∞" : "Ready";

            kpis();
            renderHighlights();
            citySpotlight();
            smartSearch();
          } catch (e) {
            console.error(e);
            $("ssStatus").textContent = "Load failed. Check console.";
          }
        }

        document.addEventListener("DOMContentLoaded", init);
      })();
    </script>
     
  </body>
</html>
